{% extends "estate/base.html" %}
{% load static %}
{% block head %}
  <link rel="stylesheet" href="{% static 'css/style_list.css' %}">
{% endblock head %}
{% block title %}
  物件一覧ページ
{% endblock title %}
{% block content %}
  <h1>物件一覧ページ</h1>
  <h2>検索機能</h2>
  <form method="get">
    <!--フリーワード検索-->
    <input type="text"
           name="q"
           placeholder="キーワード検索"
           value="{{ request.GET.q }}"
           class="form-control"
           placeholder="キーワードを入力">
    <br>
    <!--最低価格-->
    <label>
      最低価格:
      <br>
      <input type="number" name="price_min" value="{{ request.GET.price_min }}">
    </label>
    <br>
    <!--最低価格-->
    <label>
      最高価格:
      <br>
      <input type="number" name="price_max" value="{{ request.GET.price_max }}">
    </label>
    <br>
    <!--チェックボックス-->
    <div class="form-check">
      <label>
        <input type="checkbox"
               name="nature"
               value="1"
               {% if request.GET.nature %}checked{% endif %}>
        自然豊か
      </label>
      <br>
    </div>
    <div class="form-check">
      <label>
        <input type="checkbox"
               name="station"
               value="1"
               {% if request.GET.station %}checked{% endif %}>
        駅近く
      </label>
      <br>
    </div>
    <div class="form-check">
      <label>
        <input type="checkbox"
               name="remote"
               value="1"
               {% if request.GET.remote %}checked{% endif %}>
        リモート
      </label>
      <br>
    </div>
    <div class="d-flex align-items-end gap-2 flex-wrap">
      <button type="submit" class="btn btn-primary search_button mt-2 ">検索</button>
        {% if user.is_authenticated %}
          <a href="{% url 'property_create' %}" class="btn btn-success search_button ">物件登録</a>
        {% endif %}
    </div>
  </form>
  {% if search_conditions %}<p>🔍 検索条件: {{ search_conditions|join:" / " }}</p>{% endif %}
  {% if page_obj %}
    {% for p in page_obj %}
      <div class="card mb-3">
        {% if p.image %}
          <img src="{{ p.image.url }}" class="property-image" alt="物件画像">
        {% else %}
          <img src="{% static 'no_image.png' %}" class="property-image" alt="画像なし">
        {% endif %}
        <div class="property-info">
         <h5>{{ p.title }}</h5>
          <p>価格:{{ p.price }}円</p>
        </div>
        <a href="{% url 'property_detail' p.id %}" class="btn btn-outline-primary btn-sm">詳細</a>
      </div>
      {% if user.is_authenticated and user == p.owner %}
        <div>
          <a href="{% url 'property_update' p.pk %}" class="btn btn-warning">編集</a>
          <a href="{% url 'property_delete' p.pk %}" class="btn btn-danger">削除</a>
        </div>
      {% endif %}
      <div class="muted">登録日:{{ p.created_at|date:'Y-m-d H:i' }}</div>
      <div class="muted">更新日:{{ p.updated_at|date:'Y-m-d H:i' }}</div>
    {% endfor %}
  {% else %}
    {% if request.GET %}
      <div class="property_none">
        <p>条件に一致する物件がありません。</p>
      </div>
    {% else %}
      <div class="property_none">
        <p>現在、物件は登録されてません。</p>
      </div>
    {% endif %}
    <div class="list">
      <form action="{% url 'property_list' %}"
            method="get"
            style="display: inline">
        <button type="submit" class="btn btn-primary list">🔙 一覧表示に戻る</button>
      </form>
    </div>
  {% endif %}
  <!--ページネーション-->
  <div class="pagination">
    <span class="step-links">
      {% if page_obj.has_previous %}
        <a href="?page=1">&laquo; 最初</a>
        <a href="?page={{ page_obj.previous_page_number }}">前へ</a>
      {% endif %}
      <span class="current">ページ {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">次へ</a>
        <a href="?page={{ page_obj.paginator.num_pages }}"> 最後 &raquo; </a>
      {% endif %}
    </span>
  </div>
{% endblock content %}
