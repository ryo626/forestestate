{% extends "estate/base.html" %}
{% load static %}
{% block head %}
  <link rel="stylesheet" href="{% static 'css/style_list.css' %}">
{% endblock head %}
{% block title %}
  ç‰©ä»¶ä¸€è¦§ãƒšãƒ¼ã‚¸
{% endblock title %}
{% block content %}
  <h1>ç‰©ä»¶ä¸€è¦§ãƒšãƒ¼ã‚¸</h1>
  <h2>æ¤œç´¢æ©Ÿèƒ½</h2>
  <form method="get">
    <!--ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢-->
    <input type="text"
           name="q"
           placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢"
           value="{{ request.GET.q }}"
           class="form-control"
           placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
    <br>
    <!--æœ€ä½ä¾¡æ ¼-->
    <label>
      æœ€ä½ä¾¡æ ¼:
      <br>
      <input type="number" name="price_min" value="{{ request.GET.price_min }}">
    </label>
    <br>
    <!--æœ€ä½ä¾¡æ ¼-->
    <label>
      æœ€é«˜ä¾¡æ ¼:
      <br>
      <input type="number" name="price_max" value="{{ request.GET.price_max }}">
    </label>
    <br>
    <!--ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹-->
    <div class="form-check">
      <label>
        <input type="checkbox"
               name="nature"
               value="1"
               {% if request.GET.nature %}checked{% endif %}>
        è‡ªç„¶è±Šã‹
      </label>
      <br>
    </div>
    <div class="form-check">
      <label>
        <input type="checkbox"
               name="station"
               value="1"
               {% if request.GET.station %}checked{% endif %}>
        é§…è¿‘ã
      </label>
      <br>
    </div>
    <div class="form-check">
      <label>
        <input type="checkbox"
               name="remote"
               value="1"
               {% if request.GET.remote %}checked{% endif %}>
        ãƒªãƒ¢ãƒ¼ãƒˆ
      </label>
      <br>
    </div>
    <div class="d-flex align-items-end gap-2 flex-wrap">
      <button type="submit" class="btn btn-primary search_button mt-2 ">æ¤œç´¢</button>
        {% if user.is_authenticated %}
          <a href="{% url 'property_create' %}" class="btn btn-success search_button ">ç‰©ä»¶ç™»éŒ²</a>
        {% endif %}
    </div>
  </form>
  {% if search_conditions %}<p>ğŸ” æ¤œç´¢æ¡ä»¶: {{ search_conditions|join:" / " }}</p>{% endif %}
  {% if page_obj %}
    {% for p in page_obj %}
      <div class="card mb-3">
        {% if p.image %}
          <img src="{{ p.image.url }}" class="property-image" alt="ç‰©ä»¶ç”»åƒ">
        {% else %}
          <img src="{% static 'no_image.png' %}" class="property-image" alt="ç”»åƒãªã—">
        {% endif %}
        <div class="property-info">
         <h5>{{ p.title }}</h5>
          <p>ä¾¡æ ¼:{{ p.price }}å††</p>
        </div>
        <a href="{% url 'property_detail' p.id %}" class="btn btn-outline-primary btn-sm">è©³ç´°</a>
      </div>
      {% if user.is_authenticated and user == p.owner %}
        <div>
          <a href="{% url 'property_update' p.pk %}" class="btn btn-warning">ç·¨é›†</a>
          <a href="{% url 'property_delete' p.pk %}" class="btn btn-danger">å‰Šé™¤</a>
        </div>
      {% endif %}
      <div class="muted">ç™»éŒ²æ—¥:{{ p.created_at|date:'Y-m-d H:i' }}</div>
      <div class="muted">æ›´æ–°æ—¥:{{ p.updated_at|date:'Y-m-d H:i' }}</div>
    {% endfor %}
  {% else %}
    {% if request.GET %}
      <div class="property_none">
        <p>æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ç‰©ä»¶ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      </div>
    {% else %}
      <div class="property_none">
        <p>ç¾åœ¨ã€ç‰©ä»¶ã¯ç™»éŒ²ã•ã‚Œã¦ã¾ã›ã‚“ã€‚</p>
      </div>
    {% endif %}
    <div class="list">
      <form action="{% url 'property_list' %}"
            method="get"
            style="display: inline">
        <button type="submit" class="btn btn-primary list">ğŸ”™ ä¸€è¦§è¡¨ç¤ºã«æˆ»ã‚‹</button>
      </form>
    </div>
  {% endif %}
  <!--ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³-->
  <div class="pagination">
    <span class="step-links">
      {% if page_obj.has_previous %}
        <a href="?page=1">&laquo; æœ€åˆ</a>
        <a href="?page={{ page_obj.previous_page_number }}">å‰ã¸</a>
      {% endif %}
      <span class="current">ãƒšãƒ¼ã‚¸ {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">æ¬¡ã¸</a>
        <a href="?page={{ page_obj.paginator.num_pages }}"> æœ€å¾Œ &raquo; </a>
      {% endif %}
    </span>
  </div>
{% endblock content %}
